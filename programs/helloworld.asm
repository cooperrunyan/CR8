#include "<std>/arch.asm"
#include "<std>/macros.asm"

jmp [main]

#include "<std>/math.asm"

#mem 128 IMG [
    0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,
    0b01100001,0b10000000,0b00011011,0b00000000,0b00000110,0b00000110,0b00000000,0b00000000,0b01100000,0b11000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,
    0b01100001,0b10000000,0b00011011,0b00000000,0b00000110,0b00000110,0b00000000,0b00000000,0b01100000,0b11000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,
    0b01111111,0b10011111,0b10011011,0b00111111,0b00000110,0b00000110,0b01111111,0b00111110,0b01100000,0b11000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,
    0b01111111,0b10011111,0b10011011,0b00110011,0b00000110,0b01100110,0b01100011,0b00110000,0b01100111,0b11000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,
    0b01100001,0b10011000,0b00011011,0b00110011,0b00000110,0b11101100,0b01100011,0b00100000,0b01100110,0b01000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,
    0b01100001,0b10011111,0b10011011,0b00111111,0b00000011,0b10011000,0b01111111,0b00100000,0b01100111,0b11000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,
    0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,
]


main:
    mov %a, 8
    mov %b, 16
    call [mul]
    mb 0x01
    mov %c, 0

    push [IMG >> 8]
    push [IMG & 0x00FF]
    push [BRAM >> 8]
    push [BRAM & 0x00FF]

    jnza [.loop], %z
    jmp [.done]

    .loop:
        dec %z
        pop %b
        pop %c
        pop %l
        pop %h
        lw %a
        inc16 %l, %h
        push %h
        push %l
        mov %l, %b
        mov %h, %c
        sw %a
        inc16 %l, %h
        push %h
        push %l
        jnza [.loop], %z
        jmp [.done]


    .done:
        mb 0x00
        outb 1, 0x00
        halt

